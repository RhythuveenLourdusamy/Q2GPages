{"uid":"9e2d7ce61fb23b33","name":"Test Case 134 - SINGLE_MODULE_WITH_RANK_ORDER","fullName":"tests.q2g.jeeves_singleturn_test#test_single_turn_case","historyId":"b0fd10a88046cce4bc2a2a839acecaac","time":{"start":1729004927950,"stop":1729004936141,"duration":8191},"status":"failed","statusMessage":"AssertionError: [\"Select clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count'], Actual functions: ['avg']\", \"Orderby clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count(*)'], Actual functions: ['avg']\"] JEEVES_WORKFLOW_ID: f8643f3a-2c25-4b4a-bf40-264f35e7c649","statusTrace":"use_case = 'SINGLE_MODULE_WITH_RANK_ORDER'\nuser_question = 'show me Bottom 5 Survey Question group by Associated Ticket ID'\ntest_case = 134\nexpected_json = {'from': [{'name': 'Survey Question', 'product': 'freshservice', 'resource': 'Survey Question', 'type': 'RESOURCE'}], ...ce': 'Survey Question', 'type': 'FIELD', 'value': '*'}], 'name': 'COUNT(*)', 'order': 'ASC', 'type': 'FUNCTION'}], ...}\nexpected_sql = 'SELECT COUNT(*),Associated Ticket ID FROM Survey Question GROUP BY Associated Ticket ID ORDER BY COUNT(*) ASC LIMIT 5'\n\n    @pytest.mark.parametrize(\n        \"use_case, user_question, test_case, expected_json, expected_sql\",\n        ConversationAPIHelper.load_test_cases_data(product) # Kindly add the filter in template_mapper.json file before using it\n    )\n    @allure.step(\"Test single-turn conversation API\")\n    def test_single_turn_case(use_case, user_question, test_case, expected_json, expected_sql):\n>       base_conversation_test.common_test_logic(use_case, user_question, test_case, expected_json)\n\ntests/q2g/jeeves_singleturn_test.py:17: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <utils.q2g_helper.BaseConversationTest.BaseConversationTest object at 0x11c87ee70>\nuse_case = 'SINGLE_MODULE_WITH_RANK_ORDER'\nuser_question = 'show me Bottom 5 Survey Question group by Associated Ticket ID'\ntest_case = 134\nexpected_json = {'from': [{'name': 'Survey Question', 'product': 'freshservice', 'resource': 'Survey Question', 'type': 'RESOURCE'}], ...ce': 'Survey Question', 'type': 'FIELD', 'value': '*'}], 'name': 'COUNT(*)', 'order': 'ASC', 'type': 'FUNCTION'}], ...}\n\n    def common_test_logic(self, use_case, user_question, test_case, expected_json):\n        # time.sleep(30)\n        # Get the response JSON from the API call\n        response = self.api_helper.get_response_json(user_question, test_case)\n    \n        # Assert on the response code\n        assert response.status_code == 200, f\"Expected 200, got {response.status_code}. JEEVES_WORKFLOW_ID: {response.headers.get('jeeves-wf-id')}\"\n    \n        response_json = response.json()\n        jeeves_wf_id = response.headers.get('jeeves-wf-id', 'Unknown')\n    \n        # Extract the 'common_json' field from the response\n        common_json = ConversationAPIHelper.get(response_json, 'common_json')\n        # Fail the test if common_json is empty\n        assert common_json, f\"common_json is empty. Probably a multi-turn use-case. JEEVES_WORKFLOW_ID: {jeeves_wf_id}\"\n    \n        # Extract the 'query' field from the common_json, if it is present\n        actual_json = ConversationAPIHelper.get(common_json, 'query')\n    \n        # Validate the actual JSON with the expected JSON\n        result = validate_jsons(expected_json, actual_json if actual_json else common_json)\n    \n        allure.dynamic.title(f\"Test Case {test_case} - {use_case}\")\n    \n        # Assert the validation result\n>       assert result.get(\"result\"), f\"{result.get('message')} JEEVES_WORKFLOW_ID: {jeeves_wf_id}\"\nE       AssertionError: [\"Select clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count'], Actual functions: ['avg']\", \"Orderby clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count(*)'], Actual functions: ['avg']\"] JEEVES_WORKFLOW_ID: f8643f3a-2c25-4b4a-bf40-264f35e7c649\n\nutils/q2g_helper/BaseConversationTest.py:35: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1729004625624,"stop":1729004625767,"duration":143},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: [\"Select clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count'], Actual functions: ['avg']\", \"Orderby clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count(*)'], Actual functions: ['avg']\"] JEEVES_WORKFLOW_ID: f8643f3a-2c25-4b4a-bf40-264f35e7c649","statusTrace":"use_case = 'SINGLE_MODULE_WITH_RANK_ORDER'\nuser_question = 'show me Bottom 5 Survey Question group by Associated Ticket ID'\ntest_case = 134\nexpected_json = {'from': [{'name': 'Survey Question', 'product': 'freshservice', 'resource': 'Survey Question', 'type': 'RESOURCE'}], ...ce': 'Survey Question', 'type': 'FIELD', 'value': '*'}], 'name': 'COUNT(*)', 'order': 'ASC', 'type': 'FUNCTION'}], ...}\nexpected_sql = 'SELECT COUNT(*),Associated Ticket ID FROM Survey Question GROUP BY Associated Ticket ID ORDER BY COUNT(*) ASC LIMIT 5'\n\n    @pytest.mark.parametrize(\n        \"use_case, user_question, test_case, expected_json, expected_sql\",\n        ConversationAPIHelper.load_test_cases_data(product) # Kindly add the filter in template_mapper.json file before using it\n    )\n    @allure.step(\"Test single-turn conversation API\")\n    def test_single_turn_case(use_case, user_question, test_case, expected_json, expected_sql):\n>       base_conversation_test.common_test_logic(use_case, user_question, test_case, expected_json)\n\ntests/q2g/jeeves_singleturn_test.py:17: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <utils.q2g_helper.BaseConversationTest.BaseConversationTest object at 0x11c87ee70>\nuse_case = 'SINGLE_MODULE_WITH_RANK_ORDER'\nuser_question = 'show me Bottom 5 Survey Question group by Associated Ticket ID'\ntest_case = 134\nexpected_json = {'from': [{'name': 'Survey Question', 'product': 'freshservice', 'resource': 'Survey Question', 'type': 'RESOURCE'}], ...ce': 'Survey Question', 'type': 'FIELD', 'value': '*'}], 'name': 'COUNT(*)', 'order': 'ASC', 'type': 'FUNCTION'}], ...}\n\n    def common_test_logic(self, use_case, user_question, test_case, expected_json):\n        # time.sleep(30)\n        # Get the response JSON from the API call\n        response = self.api_helper.get_response_json(user_question, test_case)\n    \n        # Assert on the response code\n        assert response.status_code == 200, f\"Expected 200, got {response.status_code}. JEEVES_WORKFLOW_ID: {response.headers.get('jeeves-wf-id')}\"\n    \n        response_json = response.json()\n        jeeves_wf_id = response.headers.get('jeeves-wf-id', 'Unknown')\n    \n        # Extract the 'common_json' field from the response\n        common_json = ConversationAPIHelper.get(response_json, 'common_json')\n        # Fail the test if common_json is empty\n        assert common_json, f\"common_json is empty. Probably a multi-turn use-case. JEEVES_WORKFLOW_ID: {jeeves_wf_id}\"\n    \n        # Extract the 'query' field from the common_json, if it is present\n        actual_json = ConversationAPIHelper.get(common_json, 'query')\n    \n        # Validate the actual JSON with the expected JSON\n        result = validate_jsons(expected_json, actual_json if actual_json else common_json)\n    \n        allure.dynamic.title(f\"Test Case {test_case} - {use_case}\")\n    \n        # Assert the validation result\n>       assert result.get(\"result\"), f\"{result.get('message')} JEEVES_WORKFLOW_ID: {jeeves_wf_id}\"\nE       AssertionError: [\"Select clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count'], Actual functions: ['avg']\", \"Orderby clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count(*)'], Actual functions: ['avg']\"] JEEVES_WORKFLOW_ID: f8643f3a-2c25-4b4a-bf40-264f35e7c649\n\nutils/q2g_helper/BaseConversationTest.py:35: AssertionError","steps":[{"name":"Test single-turn conversation API","time":{"start":1729004927950,"stop":1729004936140,"duration":8190},"status":"failed","statusMessage":"AssertionError: [\"Select clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count'], Actual functions: ['avg']\", \"Orderby clause mismatch: Expected fields: [('*', 'Survey Question')], Actual fields: [('Question Score', 'Survey Question')], Expected functions: ['count(*)'], Actual functions: ['avg']\"] JEEVES_WORKFLOW_ID: f8643f3a-2c25-4b4a-bf40-264f35e7c649\n","statusTrace":"  File \"/Users/rl/PycharmProjects/auroraTestAutomation/APIautomation/lib/python3.12/site-packages/allure_commons/_allure.py\", line 192, in impl\n    return func(*a, **kw)\n           ^^^^^^^^^^^^^^\n  File \"/Users/rl/Documents/GitHub/jeeves_automation/tests/q2g/jeeves_singleturn_test.py\", line 17, in test_single_turn_case\n    base_conversation_test.common_test_logic(use_case, user_question, test_case, expected_json)\n  File \"/Users/rl/Documents/GitHub/jeeves_automation/utils/q2g_helper/BaseConversationTest.py\", line 35, in common_test_logic\n    assert result.get(\"result\"), f\"{result.get('message')} JEEVES_WORKFLOW_ID: {jeeves_wf_id}\"\n           ^^^^^^^^^^^^^^^^^^^^\n","steps":[],"attachments":[],"parameters":[{"name":"use_case","value":"'SINGLE_MODULE_WITH_RANK_ORDER'"},{"name":"user_question","value":"'show me Bottom 5 Survey Question group by Associated Ticket ID'"},{"name":"test_case","value":"134"},{"name":"expected_json","value":"{'select': [{'type': 'FUNCTION', 'name': 'COUNT', 'arguments': [{'type': 'FIELD', 'value': '*', 'resource': 'Survey Question'}], 'alias': None}, {'type': 'FIELD', 'name': 'Associated Ticket ID', 'resource': 'Survey Question'}], 'from': [{'type': 'RESOURCE', 'name': 'Survey Question', 'resource': 'Survey Question', 'product': 'freshservice'}], 'groupby': [{'type': 'FIELD', 'name': 'Associated Ticket ID', 'resource': 'Survey Question'}], 'resources': {'Survey Question': {'name': 'Survey Question', 'product': 'freshservice'}}, 'orderby': [{'type': 'FUNCTION', 'name': 'COUNT(*)', 'arguments': [{'type': 'FIELD', 'value': '*', 'resource': 'Survey Question'}], 'order': 'ASC'}], 'limit': 5}"},{"name":"expected_sql","value":"'SELECT COUNT(*),Associated Ticket ID FROM Survey Question GROUP BY Associated Ticket ID ORDER BY COUNT(*) ASC LIMIT 5'"}],"hasContent":true,"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"attachments":[{"uid":"f440b8b5c1a19cec","name":"stdout","source":"f440b8b5c1a19cec.txt","type":"text/plain","size":4796}],"parameters":[],"hasContent":true,"shouldDisplayMessage":true,"stepsCount":1,"attachmentsCount":1,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"tests.q2g"},{"name":"suite","value":"jeeves_singleturn_test"},{"name":"host","value":"FWS-CHE-LT-6357"},{"name":"thread","value":"87157-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.q2g.jeeves_singleturn_test"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"expected_json","value":"{'select': [{'type': 'FUNCTION', 'name': 'COUNT', 'arguments': [{'type': 'FIELD', 'value': '*', 'resource': 'Survey Question'}], 'alias': None}, {'type': 'FIELD', 'name': 'Associated Ticket ID', 'resource': 'Survey Question'}], 'from': [{'type': 'RESOURCE', 'name': 'Survey Question', 'resource': 'Survey Question', 'product': 'freshservice'}], 'groupby': [{'type': 'FIELD', 'name': 'Associated Ticket ID', 'resource': 'Survey Question'}], 'resources': {'Survey Question': {'name': 'Survey Question', 'product': 'freshservice'}}, 'orderby': [{'type': 'FUNCTION', 'name': 'COUNT(*)', 'arguments': [{'type': 'FIELD', 'value': '*', 'resource': 'Survey Question'}], 'order': 'ASC'}], 'limit': 5}"},{"name":"expected_sql","value":"'SELECT COUNT(*),Associated Ticket ID FROM Survey Question GROUP BY Associated Ticket ID ORDER BY COUNT(*) ASC LIMIT 5'"},{"name":"test_case","value":"134"},{"name":"use_case","value":"'SINGLE_MODULE_WITH_RANK_ORDER'"},{"name":"user_question","value":"'show me Bottom 5 Survey Question group by Associated Ticket ID'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"9e2d7ce61fb23b33.json","parameterValues":["{'select': [{'type': 'FUNCTION', 'name': 'COUNT', 'arguments': [{'type': 'FIELD', 'value': '*', 'resource': 'Survey Question'}], 'alias': None}, {'type': 'FIELD', 'name': 'Associated Ticket ID', 'resource': 'Survey Question'}], 'from': [{'type': 'RESOURCE', 'name': 'Survey Question', 'resource': 'Survey Question', 'product': 'freshservice'}], 'groupby': [{'type': 'FIELD', 'name': 'Associated Ticket ID', 'resource': 'Survey Question'}], 'resources': {'Survey Question': {'name': 'Survey Question', 'product': 'freshservice'}}, 'orderby': [{'type': 'FUNCTION', 'name': 'COUNT(*)', 'arguments': [{'type': 'FIELD', 'value': '*', 'resource': 'Survey Question'}], 'order': 'ASC'}], 'limit': 5}","'SELECT COUNT(*),Associated Ticket ID FROM Survey Question GROUP BY Associated Ticket ID ORDER BY COUNT(*) ASC LIMIT 5'","134","'SINGLE_MODULE_WITH_RANK_ORDER'","'show me Bottom 5 Survey Question group by Associated Ticket ID'"]}